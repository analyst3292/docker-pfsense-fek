<source>
  @type syslog
  port 5514
  bind 0.0.0.0
  tag pfsense

  format grok
  grok_pattern %{PFSENSE_SYSLOG_PATTERN}
  custom_pattern_path /fluentd/etc/patterns
</source>

<filter pfsense.**>
  @type ignore
  regexp1 src_ip ^(224|232|239|fe80|ff02).*
</filter>
<filter pfsense.**>
  @type ignore
  regexp1 dest_ip ^(224|232|239|fe80|ff02).*
</filter>

<filter pfsense.**>
  @type protocols
  key_port src_port
  key_proto proto
  key_prefix des
</filter>


<filter pfsense.**>
  @type geo

  enable_auto_download true
  md5_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.md5
  download_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz
  md5_path ./geoip/database/GeoLite2-City.md5
  database_path ./geoip/database/GeoLite2-City.mmdb

  lookup_field src_ip
  field_prefix geoip
  field_delimiter _
  flatten true
  geohidden false

  locale en

  continent true
  country true
  city true
  location true
  postal false
  registered_country true
  represented_country true
  subdivisions true
  traits true
  connection_type true
</filter>

  <filter pfsense.**>
    type resolv
    key_name host
    key_prefix fqdn
  </filter>
  <filter pfsense.**>
    type resolv
    key_name src_ip
    key_prefix fqdn
  </filter>
  <filter pfsense.**>
    type resolv
    key_name dest_ip
    key_prefix fqdn
  </filter>

<match pfsense.**>
  type copy

  <store>
    type elasticsearch
    host elasticsearch
    port 9200
    flush_interval 10
    logstash_prefix pfsense
    logstash_format true
    include_tag_key true
  </store>

  <store>
    type stdout
  </store>
</match>