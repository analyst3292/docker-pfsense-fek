<source>
  @type syslog
  port 5514
  bind 0.0.0.0
  tag pfsense

  format grok
  grok_pattern %{SYSLOGTIMESTAMP:date} %{SYSLOGPROG}: %{PFSENSE}
  custom_pattern_path /fluentd/etc/patterns
</source>

<filter pfsense.**>
  @type ignore
  regexp1 src_ip ^(224|232|239|fe80|ff02).*
</filter>
<filter pfsense.**>
  @type ignore
  regexp1 dest_ip ^(224|232|239|fe80|ff02).*
</filter>

<filter pfsense.**>
  @type geoip

  enable_auto_download true
  md5_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.md5
  download_url http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz
  md5_path ./geoip/database/GeoLite2-City.md5
  database_path ./geoip/database/GeoLite2-City.mmdb

  lookup_field host
  field_prefix geoip
  field_delimiter .
  flatten false

  locale en

  continent true
  country true
  city true
  location true
  postal true
  registered_country true
  represented_country true
  subdivisions true
  traits true
  connection_type true
</filter>


<match pfsense.**>
  type copy

  <store>
    type elasticsearch
    host elasticsearch
    port 9200
    flush_interval 10
    logstash_prefix pfsense
    logstash_format true
    include_tag_key true
  </store>

  <store>
    type stdout
  </store>
</match>